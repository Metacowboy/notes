> * title: CentOS 7 开启 iptables禁止外部ip访问内部端口
> * date: 2015-06-19 16:31:05

我们使用nginx作为前端代理处理网络访问请求，为了安全性考虑，要尽量访问外部ip访问一些内部端口例如mongodb的数据库27017，那么做法如下：

	# Install iptables
		yum install iptables-services
	

然后修改配置文件：

	# Mod conf
	nano /etc/sysconfig/iptables

内如如下：

	#
	# Generated by iptables-save v1.4.21 on Fri Aug  7 00:02:47 2015
	*filter
	:INPUT DROP [32:1868]
	:FORWARD DROP [0:0]
	:OUTPUT DROP [0:0]
	-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
	-A INPUT -p tcp -m tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
	-A INPUT -s 127.0.0.1/32 -d 127.0.0.1/32 -j ACCEPT
	-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
	-A INPUT -p tcp -m tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
	-A OUTPUT -p tcp -m tcp --sport 22 -j ACCEPT
	-A OUTPUT -p tcp -m tcp --sport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
	-A OUTPUT -j ACCEPT
	-A OUTPUT -p tcp -m tcp --sport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
	COMMIT
	# Completed on Fri Aug  7 00:02:47 2015
	
最后重新启动iptables服务器即可：

	service iptables save
	systemctl restart iptables.service
